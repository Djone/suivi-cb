<div class="card">
  <p-card>
    <p-table
      #dt
      [value]="subCategories"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 20, 50, 100]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="{first} à {last} sur {totalRecords} sous-catégories"
      [globalFilterFields]="['label', 'categoryLabel']"
      [tableStyle]="{ 'min-width': '50rem' }"
      styleClass="p-datatable-gridlines p-datatable-striped"
      sortField="label" [sortOrder]="1"
    >
      <!-- Bouton pour ajouter une nouvelle sous-catégorie -->
      <ng-template pTemplate="caption">
        <div class="flex align-items-center justify-content-between">
          <p-button
            label="Nouvelle sous-catégorie"
            icon="pi pi-plus"
            (click)="createSubCategory()"
            styleClass="p-button-success">
          </p-button>
          <span class="p-input-icon-left ml-auto">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="applyFilterGlobal($event, 'contains')" placeholder="Recherche globale" />
          </span>
        </div>
      </ng-template>

      <!-- En-têtes de colonnes avec tri et filtres -->
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="label" style="width: 45%">
            Libellé
            <p-sortIcon field="label" />
          </th>
          <th pSortableColumn="categoryId" style="width: 40%">
            Catégorie parente
            <p-sortIcon field="categoryId" />
          </th>
          <th style="width: 15%">Actions</th>
        </tr>
        <!-- Ligne de filtres -->
        <tr>
          <th>
            <input
              pInputText
              type="text"
              (input)="dt.filter($any($event.target).value, 'label', 'contains')"
              placeholder="Filtrer par libellé"
              class="w-full" />
          </th>
          <th>
            <p-dropdown
              [options]="parentCategories"
              (onChange)="dt.filter($event.value, 'categoryId', 'equals')"
              placeholder="Toutes les catégories"
              [showClear]="true"
              optionLabel="label"
              optionValue="id"
              styleClass="w-full">
            </p-dropdown>
          </th>
          <th></th>
        </tr>
      </ng-template>

      <!-- Corps du tableau -->
      <ng-template pTemplate="body" let-subCategory>
        <tr>
          <td>{{ subCategory.label }}</td>
          <td>
            <p-tag
              [value]="getCategoryName(subCategory.categoryId)"
              [style]="{ 'background-color': getCategoryColor(getCategoryName(subCategory.categoryId)), 'color': '#ffffff' }">
            </p-tag>
          </td>
          <td>
            <div class="flex align-items-center gap-2">
              <p-button
                icon="pi pi-pencil"
                (click)="editSubCategory(subCategory)"
                styleClass="p-button-rounded p-button-text p-button-info"
                pTooltip="Éditer"
                tooltipPosition="top">
              </p-button>
              <p-button
                icon="pi pi-trash"
                (click)="deleteSubCategory(subCategory)"
                styleClass="p-button-rounded p-button-text p-button-danger"
                pTooltip="Supprimer"
                tooltipPosition="top">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Message si aucune donnée -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3" class="text-center">Aucune sous-catégorie trouvée.</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
