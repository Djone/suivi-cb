<div class="recurring-transaction-form-container">
  <h2>Ajouter une échéance récurrente</h2>

  <form [formGroup]="recurringTransactionForm" (ngSubmit)="onSubmit()" class="recurring-form">
    <!-- Type de flux financier -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Type</mat-label>
      <mat-icon matPrefix>swap_vert</mat-icon>
      <mat-select formControlName="financialFlowId">
        <mat-option *ngFor="let flow of financialFlows" [value]="flow.id">
          {{ flow.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="recurringTransactionForm.get('financialFlowId')?.hasError('required')">
        Le type est requis
      </mat-error>
    </mat-form-field>

    <!-- Compte bancaire -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Compte bancaire</mat-label>
      <mat-icon matPrefix>account_balance</mat-icon>
      <mat-select formControlName="accountId">
        <mat-option *ngFor="let account of accounts" [value]="account.id">
          {{ account.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="recurringTransactionForm.get('accountId')?.hasError('required')">
        Le compte est requis
      </mat-error>
    </mat-form-field>

    <!-- Libellé -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Libellé</mat-label>
      <mat-icon matPrefix>label</mat-icon>
      <input matInput formControlName="label" placeholder="Ex: Loyer, Salaire, Électricité...">
      <mat-error *ngIf="recurringTransactionForm.get('label')?.hasError('required')">
        Le libellé est requis
      </mat-error>
    </mat-form-field>

    <!-- Montant -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Montant</mat-label>
      <mat-icon matPrefix>euro</mat-icon>
      <input matInput type="number" formControlName="amount" step="0.01">
      <mat-error *ngIf="recurringTransactionForm.get('amount')?.hasError('required')">
        Le montant est requis
      </mat-error>
      <mat-error *ngIf="recurringTransactionForm.get('amount')?.hasError('min')">
        Le montant doit être supérieur à 0
      </mat-error>
    </mat-form-field>

    <!-- Périodicité -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Périodicité</mat-label>
      <mat-icon matPrefix>repeat</mat-icon>
      <mat-select formControlName="frequency">
        <mat-option *ngFor="let freq of frequencies" [value]="freq.value">
          {{ freq.label }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="recurringTransactionForm.get('frequency')?.hasError('required')">
        La périodicité est requise
      </mat-error>
    </mat-form-field>

    <!-- Jour du mois (pour périodicités mensuelles et plus) -->
    <mat-form-field *ngIf="!isWeeklyFrequency()" appearance="fill" class="full-width">
      <mat-label>Jour du mois</mat-label>
      <mat-icon matPrefix>event</mat-icon>
      <mat-select formControlName="dayOfMonth">
        <mat-option *ngFor="let day of daysOfMonth" [value]="day">
          {{ day }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="recurringTransactionForm.get('dayOfMonth')?.hasError('required')">
        Le jour est requis
      </mat-error>
    </mat-form-field>

    <!-- Jour de la semaine (pour périodicité hebdomadaire) -->
    <mat-form-field *ngIf="isWeeklyFrequency()" appearance="fill" class="full-width">
      <mat-label>Jour de la semaine</mat-label>
      <mat-icon matPrefix>calendar_today</mat-icon>
      <mat-select formControlName="dayOfMonth">
        <mat-option *ngFor="let day of daysOfWeek" [value]="day.value">
          {{ day.label }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="recurringTransactionForm.get('dayOfMonth')?.hasError('required')">
        Le jour de la semaine est requis
      </mat-error>
    </mat-form-field>

    <!-- Sous-catégorie -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Sous-catégorie</mat-label>
      <mat-icon matPrefix>category</mat-icon>
      <mat-select formControlName="subCategoryId">
        <mat-option *ngFor="let subcategory of subcategories" [value]="subcategory.id">
          {{ subcategory.label }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="recurringTransactionForm.get('subCategoryId')?.hasError('required')">
        La sous-catégorie est requise
      </mat-error>
    </mat-form-field>

    <!-- Boutons -->
    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="!recurringTransactionForm.valid">
        <mat-icon>add</mat-icon>
        Ajouter l'échéance
      </button>
      <button mat-raised-button type="button" (click)="resetForm()">
        <mat-icon>clear</mat-icon>
        Réinitialiser
      </button>
    </div>
  </form>

  <!-- Liste des transactions récurrentes -->
  <app-recurring-transaction-list></app-recurring-transaction-list>
</div>
